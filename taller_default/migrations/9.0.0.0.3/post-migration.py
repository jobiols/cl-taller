# For copyright and license notices, see __manifest__.py file in module root
# Corregir problema de desaparicion del cliente Edenor

from openupgradelib import openupgrade
import logging

_logger = logging.getLogger(__name__)


@openupgrade.migrate(use_env=True)
def migrate(env, version):
    """ Cambia el cliente de las facturas y las lineas de contabilidad por
        edenor.
    """
    ai_obj = env['account.invoice']
    partner_obj = env['res.partner']
    account_move_obj = env['account.move']
    account_move_line_obj = env['account.move.line']

    _logger.info('Migration -> Corregir facturas de Edenor')

    edn = partner_obj.search([('ref', '=', 'edenor')])

    # buscar las facturas
    facturas = [
        '0006-00000061',
        '0006-00000060',
        '0006-00000061',
        '0006-00000060',
        '0006-00000059',
        '0003-00000075',
        '0006-00000058',
        '0006-00000056',
        '0006-00000055',
        '0006-00000054',
        '0006-00000053',
        '0006-00000052',
        '0006-00000051',
        '0006-00000049',
        '0006-00000003',
        '0003-00000074',
        '0006-00000047',
        '0006-00000043',
        '0006-00000002',
        '0006-00000042',
        '0006-00000040',
        '0006-00000036',
        '0006-00000035',
        '0006-00000034',
        '0006-00000033',
        '0006-00000030',
        '0006-00000029',
        '0006-00000028',
        '0006-00000027',
        '0006-00000026',
        '0006-00000024',
        '0006-00000022',
        '0006-00000021',
        '0006-00000020',
        '0006-00000018',
        '0006-00000017',
        '0006-00000016',
        '0006-00000015',
        '0006-00000013',
        '0006-00000012',
        '0006-00000011',
        '0006-00000010',
        '0006-00000007',
        '0003-00000067',
        '0003-00000066',
        '0003-00000065',
        '0003-00000064',
        '0003-00000063',
        '0003-00000062',
        '0003-00000061',
        '0003-00000059',
        '0003-00000058',
        '0003-00000057',
        '0003-00000056',
        '0003-00000055',
        '0003-00000054',
        '0003-00000053',
        '0003-00000052',
        '0003-00000050',
        '0003-00000049',
        '0003-00000048',
        '0003-00000047',
        '0003-00000046',
        '0003-00000045',
        '0003-00000044',
        '0003-00000043',
        '0003-00000042',
        '0003-00000037',
        '0003-00000036',
        '0003-00000034',
        '0003-00000033',
        '0003-00000032',
        '0003-00000028',
        '0003-00000027',
        '0003-00000026',
        '0003-00000004',
        '0003-00000003',
        '0003-00000001',
        '0006-00000059',
        '0003-00000075',
        '0006-00000058',
        '0006-00000056',
        '0006-00000055',
        '0006-00000054',
        '0006-00000053',
        '0006-00000052',
        '0006-00000051',
        '0006-00000049',
        '0006-00000003',
        '0003-00000074',
        '0006-00000047',
        '0006-00000043',
        '0006-00000002',
        '0006-00000042',
        '0006-00000040',
        '0006-00000036',
        '0006-00000035',
        '0006-00000034',
        '0006-00000033',
        '0006-00000030',
        '0006-00000029',
        '0006-00000028',
        '0006-00000027',
        '0006-00000026',
        '0006-00000024',
        '0006-00000022',
        '0006-00000021',
        '0006-00000020',
        '0006-00000018',
        '0006-00000017',
        '0006-00000016',
        '0006-00000015',
        '0006-00000013',
        '0006-00000012',
        '0006-00000011',
        '0006-00000010',
        '0006-00000007',
        '0003-00000067',
        '0003-00000066',
        '0003-00000065',
        '0003-00000064',
        '0003-00000063',
        '0003-00000062',
        '0003-00000061',
        '0003-00000059',
        '0003-00000058',
        '0003-00000057',
        '0003-00000056',
        '0003-00000055',
        '0003-00000054',
        '0003-00000053',
        '0003-00000052',
        '0003-00000050',
        '0003-00000049',
        '0003-00000048',
        '0003-00000047',
        '0003-00000046',
        '0003-00000045',
        '0003-00000044',
        '0003-00000043',
        '0003-00000042',
        '0003-00000037',
        '0003-00000036',
        '0003-00000034',
        '0003-00000033',
        '0003-00000032',
        '0003-00000028',
        '0003-00000027',
        '0003-00000026',
        '0003-00000004',
        '0003-00000003',
        '0003-00000001']

    for factura in facturas:
        fa = ai_obj.search([('document_number', '=', factura),
                            ('document_letter_name', '=', 'A'),
                            ('type', '=', 'out_invoice')])
        _logger.info('Migration -> Corrigiendo factura %s' % factura)

        if fa:

            # corregir cliente de la factura
            fa.partner_id = edn.id

            if fa.move_id:
                # corregir cliente en el asiento
                fa.move_id.partner_id = edn.id
                # corregir cliente en las elementos del asiento
                for aml in fa.move_id.line_ids:
                    aml.partner_id = edn.id

                # lineas de asiento
                amls = account_move_line_obj.search(
                    [('move_id', '=', fa.move_id.id)])

                for aml in amls:
                    aml.partner_id = edn.id
